## 比赛简介
	"合肥高新杯"心电人机智能大赛（https://tianchi.aliyun.com/competition/entrance/231754/introduction） 
	心电图是医院心脏疾病常用辅助诊断指标。心电图由于其价格低、无创的特性被广泛用于心脏疾病的预筛查以及体检中，每天的检测量巨大。目前，多导联的心电图设备已经广泛用于临床当中，部分设备已经具有自动分析诊断功能，但自动分析对于多心电异常事件的判别还不够精确，需要医生做进一步修改。
	
近年来，人工智能在心电图预测领域有了应用。AI技术、深度学习的发展有望助力心电图波形、心电异常事件的预测，从而达到提升预测精度的目标。

本次大赛要求选手以心电图异常事件预测为赛题方向，依据心电图机8导联的数据，以及病患年龄、性别等因素，用统计学、机器学习、深度学习等方式探索挖掘心电波形与心电异常事件之间的关系，构建精准预测模型。

心电图机8导联的数据，以及病患年龄、性别等因素。

## 方案
    选用2个模型，传统模型和深度模型，加权得到最终结果。
    传统模型，提取特征，每类分别训练模型
    深度模型，resnet34
	最终复赛成绩[21/2353]

## 文件说明
	dnn 深度模型resnet34代码，使用开源的基线代码，修改了优化器，其它未改动。
	extract_features 传统方法
	submit 复赛docker提交文件

## 评价指标F1
	

## 数据预处理
### 缺失值处理
	一条记录的心电图8导联数据会存在部分数据缺失，体现为数据为0。
	如果大部分导联数据为0，则删除此条记录。

### 性别和年龄
	性别 one-hot编码
	年龄 缺失值用平均值代替
	
### 数据归一化

### 数据去噪
心电信号是一种随机性强、幅值微弱、信噪比低的生理信号,在采集期间,心电信号极易受到心电图机、电极连接以及病人自身的运动伪迹等因素的影响,从而引入噪声干扰,这些常见的噪声主要包括了肌电噪声、工频噪声和基线漂移等。
#### 方法一 使用过滤器去噪
	采样频率为500hz,信号本身最大的频率为250hz，使用带通滤波滤除3hz以下和40hz以上频率成分。
	波形信号上有很多噪音，这些噪音都是成百Hz的，这些对于ecg信号波形就属于无用的噪音，我们就噪声信号过滤掉，此时得到的波形就会比较平滑了。
	过滤之后会发现R波的峰值会被削弱，如果T波的峰值比较大，再接下来工作中可能会造成R波和T波的误判。
	
#### 方法二 小波降噪
高斯噪声往往由小波域中的小值表示，可以通过将低于给定阈值的系数设置为零（硬阈值）或将所有系数收缩为零（软阈值）来消除。
使用图像的两种不同的小波系数阈值选择方法：Bayesshrink和Visushrink。

Visushrink算法
Visushrink方法对所有小波细节系数采用一个单一的通用阈值。该阈值用于去除高概率的加性高斯噪声，这种加性高斯噪声往往导致图像过于平滑。通过指定一个小于真实噪声标准偏差的西格玛，可以得到一个更直观的令人满意的结果。

Bayesshrink算法
Bayesshrink算法是小波软阈值的一种自适应方法，它对每个小波子带估计一个唯一的阈值。这通常会导致对单个阈值所能获得的结果的改进。

采用scikit-image库小波降噪的方法，对源码进行部分修改，对图像三维数据的处理改成二维数据处理。
使用coif5小波基和Visushrink算法，会得到较好的波形，R峰不会被过多削弱。

### 模板提取
一个正常的心电信号在一个周期内，是由P波，QRS波群以及T波组成
P波：代表心脏除极，一般呈现钝圆形，幅度约为0.25mV，持续时间为0.08~0.11s。
PR间期：指心房除极开始到心室除极开始的传导时间，一般是从P波开始到QRS波的起点，正常PR间隔时间为：0.12s-0.20s。
QRS：代表心室肌的除极产生的电位变化，是心电图中最高大，快速的波形。
T波：代表心室肌的复极
QT间期：代表心脏去极化和复极过程，即心室收缩的总时间。QT 间隔和心率相关，心率越快，QT 间隔越短，反之越长
RR间隔：是指连续两个心电周期 R 峰值间隔变化特征，是常用的心拍识别标准之一。

使用biosppy(Hamilton)提取R波位置，再根据标准模板的pqrst固定时间间隔和RR间隔给p波和T波


## 特征提取
波形基本统计量
### 频率特征提取
	
	
### 时域特征提取
	fft、小波分解能量提取

### hrv特征


## 模型训练
### lightgbm、xgboost、catboost
	xgboost训练时间太长放弃
	catboost 未调参下，准确率未比lightgbm，由于时间原因放弃
	lightgbm

## 其它的一些想法未实现
	fastdtw 采用动态规划来计算两个时间序列之间的相似性，耗时太长，卒。


## 深度模型
	使用resnet34模型。尝试过resnet34改进版，得分反而变低。
	优化器 adam Ranger
	针对数据不平衡，loss函数
	
## 模型融合
	深度模型低偏差，高方差。
	时间关系，只是加权平均了一下。
	可参考。。。
	
## 所使用的库
	pandas
	tqdm
	scikit-learn
	lightgbm==2.1.1
	seaborn
	wfdb
	pywavelets==1.0.3
	pytorch==1.1.0
	
## 参考代码
https://physionet.org/challenge/2017/
https://github.com/JavisPeng/ecg_pytorch?spm=5176.12282029.0.0.3d952737ec5tuc
https://github.com/victorkifer/ecg-af-detection-physionet-2017
